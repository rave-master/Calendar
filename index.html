<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSD Calendar Dashboard</title>
    <link rel="icon" href="https://ia601205.us.archive.org/12/items/icon_20250717/icon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
        }
        .activity-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
            margin: 1px;
        }
        @media (min-width: 768px) {
            .activity-dot {
                width: 8px;
                height: 8px;
            }
        }
        .calendar-day {
            transition: all 0.2s ease;
            min-height: 60px;
        }
        .calendar-day:hover {
            transform: translateY(-1px);
        }
        @media (min-width: 768px) {
            .calendar-day {
                min-height: 80px;
            }
            .calendar-day:hover {
                transform: translateY(-2px);
            }
        }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hover-modal {
            position: absolute;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            padding: 12px;
            z-index: 1000;
            max-width: 280px;
            border: 1px solid #e5e7eb;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            pointer-events: none;
        }
        @media (min-width: 768px) {
            .hover-modal {
                max-width: 300px;
            }
        }
        .hover-modal.show {
            opacity: 1;
            transform: translateY(0);
        }
        /* Mobile touch improvements */
        @media (max-width: 767px) {
            .calendar-day {
                -webkit-tap-highlight-color: rgba(59, 130, 246, 0.1);
                tap-highlight-color: rgba(59, 130, 246, 0.1);
            }
            .hover-modal {
                display: none; /* Hide hover modals on mobile */
            }
        }
        /* Ensure proper spacing on mobile */
        .mobile-container {
            padding: 1rem;
        }
        @media (min-width: 640px) {
            .mobile-container {
                padding: 2rem;
            }
        }
    </style>
</head>
<body class="relative min-h-screen bg-[url('de.jpg')] bg-cover bg-center">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-6 md:mb-8">
            <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-2">TSD Calendar of Activities</h1>
            <p class="text-sm md:text-base text-gray-600">Track and view scheduled activities</p>
            
            <!-- Fill Me Up Button -->
            <div class="mt-4 md:mt-6">
                <button id="fillMeUpBtn" class="fill-me-up-btn bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-2 px-6 md:py-3 md:px-8 rounded-full shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-xl text-sm md:text-base">
                    <span class="flex items-center gap-2">
                        <svg class="w-4 h-4 md:w-5 md:h-5 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Fill Me Up
                        <svg class="w-4 h-4 md:w-5 md:h-5 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                    </span>
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="flex justify-center items-center py-20">
            <div class="loading-spinner"></div>
            <span class="ml-3 text-gray-600">Loading activities...</span>
        </div>

        <!-- Calendar Navigation -->
        <div id="calendar-container" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-3 md:p-6 mb-4 md:mb-6">
                <div class="flex justify-between items-center mb-4 md:mb-6">
                    <button id="prevMonth" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 md:px-4 md:py-2 rounded-lg transition-colors text-sm md:text-base">
                        ‚Üê Prev
                    </button>
                    <h2 id="currentMonth" class="text-lg md:text-2xl font-semibold text-gray-800 text-center flex-1 mx-2"></h2>
                    <button id="nextMonth" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 md:px-4 md:py-2 rounded-lg transition-colors text-sm md:text-base">
                        Next ‚Üí
                    </button>
                </div>

                <!-- Calendar Grid -->
                <div class="grid grid-cols-7 gap-1 md:gap-2 mb-2 md:mb-4">
                    <div class="text-center font-semibold text-gray-600 py-1 md:py-2 text-xs md:text-sm">Sun</div>
                    <div class="text-center font-semibold text-gray-600 py-1 md:py-2 text-xs md:text-sm">Mon</div>
                    <div class="text-center font-semibold text-gray-600 py-1 md:py-2 text-xs md:text-sm">Tue</div>
                    <div class="text-center font-semibold text-gray-600 py-1 md:py-2 text-xs md:text-sm">Wed</div>
                    <div class="text-center font-semibold text-gray-600 py-1 md:py-2 text-xs md:text-sm">Thu</div>
                    <div class="text-center font-semibold text-gray-600 py-1 md:py-2 text-xs md:text-sm">Fri</div>
                    <div class="text-center font-semibold text-gray-600 py-1 md:py-2 text-xs md:text-sm">Sat</div>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-1 md:gap-2"></div>
            </div>

            <!-- Activity Details -->
            <div id="activity-details" class="bg-white rounded-xl shadow-lg p-3 md:p-6 hidden">
                <h3 class="text-lg md:text-xl font-semibold text-gray-800 mb-3 md:mb-4">Activities for <span id="selected-date"></span></h3>
                <div id="activities-list"></div>
            </div>

            <!-- Legend -->
            <div class="bg-white rounded-xl shadow-lg p-3 md:p-6 mt-4 md:mt-6">
                <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-3 md:mb-4">Activity Types</h3>
                <div id="legend" class="flex flex-wrap gap-2 md:gap-4"></div>
            </div>
        </div>

        <!-- Hover Modal -->
        <div id="hover-modal" class="hover-modal">
            <div id="hover-content"></div>
        </div>
    </div>

    <script>
        let activities = [];
        let currentDate = new Date();
        let activityTypes = new Map();
        
        const colors = [
            '#ef4444', '#f97316', '#eab308', '#22c55e', 
            '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899'
        ];

        // Fetch and parse CSV data
        async function loadActivities() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vTGUN_LWlXql9zJP56x_RCuiiCvRlC484gdR0LCE6VPsifLLNxA9vMObLX263wVYdsw7RAMs84vhpn3/pub?output=csv');
                const csvText = await response.text();
                
                const lines = csvText.split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                
                activities = [];
                let colorIndex = 0;
                
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim()) {
                        const values = parseCSVLine(lines[i]);
                        const activity = {};
                        
                        headers.forEach((header, index) => {
                            activity[header] = values[index] || '';
                        });
                        
                        // Parse date using the Date column
                        if (activity.Date) {
                            activity.parsedDate = parseDate(activity.Date);
                            if (activity.parsedDate) {
                                // Assign specific colors to sections
                                const section = activity.Section || 'Other';
                                if (!activityTypes.has(section)) {
                                    // Assign specific colors for each section
                                    const sectionColors = {
                                        'MES': '#ff161f',    // Red
                                        'TSD': '#ffd90b',    // Yellow
                                        'CDS': '#1d741b',    // Green
                                        'RPS': '#1800ad',    // Blue
                                        'Other': '#6b7280'   // Gray
                                    };
                                    activityTypes.set(section, sectionColors[section] || colors[colorIndex % colors.length]);
                                    colorIndex++;
                                }
                                activity.color = activityTypes.get(section);
                                activities.push(activity);
                            }
                        }
                    }
                }
                
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('calendar-container').classList.remove('hidden');
                renderCalendar();
                renderLegend();
                
            } catch (error) {
                console.error('Error loading activities:', error);
                document.getElementById('loading').innerHTML = 
                    '<div class="text-red-600">Error loading activities. Please check the CSV URL.</div>';
            }
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        function findDateField(activity) {
            const dateFields = ['Date', 'date', 'Start Date', 'Event Date', 'When', 'Time'];
            for (const field of dateFields) {
                if (activity[field]) return field;
            }
            return Object.keys(activity)[0]; // Fallback to first field
        }

        function parseDate(dateStr) {
            if (!dateStr) return null;
            
            // Try various date formats
            const formats = [
                /(\d{1,2})\/(\d{1,2})\/(\d{4})/,  // MM/DD/YYYY
                /(\d{4})-(\d{1,2})-(\d{1,2})/,   // YYYY-MM-DD
                /(\d{1,2})-(\d{1,2})-(\d{4})/    // DD-MM-YYYY
            ];
            
            for (const format of formats) {
                const match = dateStr.match(format);
                if (match) {
                    if (format === formats[1]) { // YYYY-MM-DD
                        return new Date(match[1], match[2] - 1, match[3]);
                    } else { // MM/DD/YYYY or DD-MM-YYYY
                        return new Date(match[3], match[1] - 1, match[2]);
                    }
                }
            }
            
            // Fallback to Date constructor
            const parsed = new Date(dateStr);
            return isNaN(parsed.getTime()) ? null : parsed;
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayActivities = activities.filter(activity => 
                    activity.parsedDate && 
                    activity.parsedDate.toDateString() === cellDate.toDateString()
                );
                
                const isCurrentMonth = cellDate.getMonth() === month;
                const isToday = cellDate.toDateString() === new Date().toDateString();
                
                const dayElement = document.createElement('div');
                dayElement.className = `calendar-day p-2 md:p-3 border rounded-lg cursor-pointer ${
                    isCurrentMonth ? 'bg-white hover:bg-blue-50' : 'bg-gray-100 text-gray-400'
                } ${isToday ? 'ring-2 ring-blue-500' : ''}`;
                
                dayElement.innerHTML = `
                    <div class="font-semibold mb-1 text-sm md:text-base">${cellDate.getDate()}</div>
                    <div class="flex flex-wrap">
                        ${dayActivities.map(activity => 
                            `<div class="activity-dot" style="background-color: ${activity.color}" title="${activity.Section}: ${activity.Activity || 'Activity'}"></div>`
                        ).join('')}
                    </div>
                `;
                
                dayElement.addEventListener('click', () => showActivities(cellDate, dayActivities));
                
                // Add hover functionality
                dayElement.addEventListener('mouseenter', (e) => showHoverModal(e, cellDate, dayActivities));
                dayElement.addEventListener('mouseleave', hideHoverModal);
                
                grid.appendChild(dayElement);
            }
        }

        function showActivities(date, dayActivities) {
            const detailsDiv = document.getElementById('activity-details');
            const selectedDateSpan = document.getElementById('selected-date');
            const activitiesList = document.getElementById('activities-list');
            
            selectedDateSpan.textContent = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            if (dayActivities.length === 0) {
                activitiesList.innerHTML = '<p class="text-gray-500">No activities scheduled for this day.</p>';
            } else {
                activitiesList.innerHTML = dayActivities.map(activity => `
                    <div class="border-l-4 pl-3 md:pl-4 py-2 md:py-3 mb-2 md:mb-3" style="border-color: ${activity.color}">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full text-white" style="background-color: ${activity.color}">
                                ${activity.Section || 'Other'}
                            </span>
                        </div>
                        <h4 class="font-semibold text-gray-800 text-sm md:text-base">${activity.Activity || 'Activity'}</h4>
                        ${activity.Description ? `<p class="text-gray-600 mt-1 text-sm">${activity.Description}</p>` : ''}
                        ${activity.Time ? `<p class="text-xs md:text-sm text-gray-500 mt-1">‚è∞ ${activity.Time}</p>` : ''}
                        ${activity.Location ? `<p class="text-xs md:text-sm text-gray-500 mt-1">üìç ${activity.Location}</p>` : ''}
                    </div>
                `).join('');
            }
            
            detailsDiv.classList.remove('hidden');
            detailsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function showHoverModal(event, date, dayActivities) {
            const modal = document.getElementById('hover-modal');
            const content = document.getElementById('hover-content');
            
            if (dayActivities.length === 0) {
                content.innerHTML = `
                    <div class="text-sm text-gray-600">
                        <div class="font-semibold mb-1">${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                        <div>No activities</div>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="text-sm">
                        <div class="font-semibold text-gray-800 mb-2">${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                        ${dayActivities.slice(0, 3).map(activity => `
                            <div class="flex items-center gap-2 mb-1">
                                <div class="w-2 h-2 rounded-full" style="background-color: ${activity.color}"></div>
                                <span class="text-xs font-medium text-white px-1 py-0.5 rounded" style="background-color: ${activity.color}">
                                    ${activity.Section}
                                </span>
                                <span class="text-gray-700 text-xs">${activity.Activity}</span>
                            </div>
                        `).join('')}
                        ${dayActivities.length > 3 ? `<div class="text-xs text-gray-500 mt-1">+${dayActivities.length - 3} more...</div>` : ''}
                    </div>
                `;
            }
            
            // Position the modal beside the date box with better viewport awareness
            const rect = event.target.getBoundingClientRect();
            const modalWidth = 300; // max-width from CSS
            const modalHeight = 120; // estimated modal height
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const spaceOnRight = windowWidth - rect.right;
            const spaceOnLeft = rect.left;
            const spaceBelow = windowHeight - rect.bottom;
            const spaceAbove = rect.top;
            
            let leftPosition, topPosition, transform;
            
            // First, try to position horizontally (right or left)
            if (spaceOnRight >= modalWidth + 10) {
                // Show on the right side
                leftPosition = rect.right + 10;
                
                // Check if we need to adjust vertically
                if (spaceBelow >= modalHeight / 2 && spaceAbove >= modalHeight / 2) {
                    // Center vertically next to the date box
                    topPosition = rect.top + rect.height / 2;
                    transform = 'translateY(-50%)';
                } else if (spaceBelow < modalHeight / 2) {
                    // Position above the date box if not enough space below
                    topPosition = rect.top - 10;
                    transform = 'translateY(-100%)';
                } else {
                    // Position below the date box
                    topPosition = rect.bottom + 10;
                    transform = 'translateY(0)';
                }
                
            } else if (spaceOnLeft >= modalWidth + 10) {
                // Show on the left side
                leftPosition = rect.left - modalWidth - 10;
                
                // Check if we need to adjust vertically
                if (spaceBelow >= modalHeight / 2 && spaceAbove >= modalHeight / 2) {
                    // Center vertically next to the date box
                    topPosition = rect.top + rect.height / 2;
                    transform = 'translateY(-50%)';
                } else if (spaceBelow < modalHeight / 2) {
                    // Position above the date box if not enough space below
                    topPosition = rect.top - 10;
                    transform = 'translateY(-100%)';
                } else {
                    // Position below the date box
                    topPosition = rect.bottom + 10;
                    transform = 'translateY(0)';
                }
                
            } else {
                // Not enough horizontal space, position above or below
                leftPosition = rect.left + rect.width / 2;
                
                if (spaceAbove >= modalHeight + 10) {
                    // Position above
                    topPosition = rect.top - 10;
                    transform = 'translateX(-50%) translateY(-100%)';
                } else {
                    // Position below
                    topPosition = rect.bottom + 10;
                    transform = 'translateX(-50%) translateY(0)';
                }
            }
            
            modal.style.left = `${leftPosition}px`;
            modal.style.top = `${topPosition}px`;
            modal.style.transform = transform;
            
            // Show modal
            modal.classList.add('show');
        }

        function hideHoverModal() {
            const modal = document.getElementById('hover-modal');
            modal.classList.remove('show');
        }

        function renderLegend() {
            const legend = document.getElementById('legend');
            legend.innerHTML = '';
            
            activityTypes.forEach((color, type) => {
                const legendItem = document.createElement('div');
                legendItem.className = 'flex items-center';
                legendItem.innerHTML = `
                    <div class="w-3 h-3 md:w-4 md:h-4 rounded-full mr-2" style="background-color: ${color}"></div>
                    <span class="text-xs md:text-sm text-gray-700">${type}</span>
                `;
                legend.appendChild(legendItem);
            });
        }

        // Navigation
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        // Fill Me Up Button functionality
        document.getElementById('fillMeUpBtn').addEventListener('click', () => {
            // Replace this URL with your actual Google Form URL
            const googleFormUrl = 'https://forms.gle/your-google-form-id';
            window.open(googleFormUrl, '_blank', 'noopener,noreferrer');
        });

        // Initialize
        loadActivities();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9872345b02ebfc92',t:'MTc1OTIxOTQxNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
    </script>
    
<script>
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.onkeydown = function(e) {
    if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 'I'.charCodeAt(0))) {
      return false;
    }
  };
</script>



</body>
</html>
